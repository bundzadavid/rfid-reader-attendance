@model IEnumerable<AttendanceStatsModel>

@{
    ViewData["Title"] = "Attendance Visualization";
    var stats = Model.ToList();
    
    var chartData = stats.Select(s => {
        var workHours = 0.0;
        if (s.AverageArrivalTime.HasValue && s.AverageDepartureTime.HasValue)
        {
            var duration = s.AverageDepartureTime.Value - s.AverageArrivalTime.Value;
            workHours = duration.TotalHours;
        }
        return new { s.PersonName, workHours };
    }).ToList();
}

<div class="container-fluid mt-5 px-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="display-5 fw-bold">📈 Average Time at Work</h1>
            <p class="text-muted">Daily work duration by employee</p>
        </div>
        <div>
            <a asp-controller="Attendance" asp-action="Stats" class="btn btn-outline-primary me-2">
                📊 View Summary
            </a>
            <a asp-controller="Attendance" asp-action="Index" class="btn btn-lg btn-outline-secondary">
                ← Back to Home
            </a>
        </div>
    </div>

    @if (!stats.Any())
    {
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>⚠️ No data available</strong> - Please process data first.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    else
    {
        <!-- Summary Stats Grid -->
        <div class="row g-4 mb-5">
            @foreach (var data in chartData)
            {
                var hours = (int)data.workHours;
                var minutes = (int)((data.workHours * 60) % 60);
                
                <div class="col-md-6 col-lg-4">
                    <div class="card border-0 shadow-sm h-100" style="cursor: pointer; transition: all 0.3s ease;" onclick="showDetails('@data.PersonName', @hours, @minutes)" onmouseover="this.style.transform='translateY(-10px)'; this.style.boxShadow='0 12px 25px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';">
                        <div class="card-body text-center">
                            <h5 class="card-title fw-bold">👤 @data.PersonName</h5>
                            <h2 class="display-6 text-primary fw-bold">@hours h @minutes m</h2>
                            <p class="text-muted small">Click for details</p>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Details Panel -->
        <div class="row g-4">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-success bg-gradient text-white">
                        <h5 class="card-title mb-0" id="detailsTitle">👤 Click on a card to see details</h5>
                    </div>
                    <div class="card-body">
                        <div id="detailsContent">
                            <p class="text-muted text-center">Select an employee from the cards above</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<script>
    function showDetails(personName, hours, minutes) {
        document.getElementById('detailsTitle').textContent = '👤 ' + personName;
        document.getElementById('detailsContent').innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-muted">Total Time at Work</h6>
                    <h2 class="display-5 text-primary fw-bold">${hours} h ${minutes} m</h2>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted">Breakdown</h6>
                    <p class="fs-5">
                        <strong>${hours}</strong> hours<br>
                        <strong>${minutes}</strong> minutes
                    </p>
                </div>
            </div>
        `;
    }
</script>

<style>
    .bg-gradient {
        background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-primary) 100%) !important;
    }
    .card {
        transition: all 0.3s ease;
    }
    .display-5 {
        color: #2c3e50;
        font-weight: 700;
    }
    .display-6 {
        font-weight: 700;
    }
</style>